# 非機能要件定義書

## 1. 本資料の目的

本資料は、部活動向け業務支援システムにおける  
**非機能要件（品質・制約・運用・セキュリティに関する要件）** を定義し、  
設計および実装時の指針とすることを目的とする。

本資料はフェーズ1（MVP）を対象とし、  
過剰な設計を避けつつ、業務システムとして最低限必要な品質を確保する。

---

## 2. 対象範囲

本資料は以下の機能を対象とする。

- 欠席系 申請・承認管理
- 試合結果報告 申請・承認管理
- 練習スケジュール共有
- 通知機能
- 監査ログ機能

---

# 3. セキュリティ要件

## 3.1 認証

- ユーザーは認証済みでなければシステムを利用できない
- 認証方式はトークンベース認証（JWT）を採用する
- 認証情報（秘密鍵、署名鍵等）はソースコードに含めない
- 秘密情報は環境変数または安全なストアで管理する
- パスワードはハッシュ化して保存する（平文保存禁止）

---

## 3.2 認可

- ロールベースアクセス制御（RBAC）を採用する
- ロールは以下を基本とする
  - 生徒
  - 監督・コーチ
  - 管理者
- 各操作の可否は「ロール × 状態」により制御する
- 最終的な業務認可（承認可否など）はバックエンドで必ず判定する

---

## 3.3 データ分離

- データは部活動単位で分離して管理する
- 他部活動のデータへアクセスできないことを保証する
- APIは必ず部活動IDに基づいてデータを絞り込む

---

# 4. 監査・ログ要件

## 4.1 監査ログ

以下の業務操作を監査ログとして記録する。

- 申請提出
- 承認
- 差し戻し
- 却下
- 申請取消
- 練習スケジュール登録／編集／削除

監査ログは以下の特性を持つ。

- 専用テーブルに保存する
- 追記専用（INSERT ONLY）とする
- 更新・削除は行わない
- 操作種別、操作者、操作日時、対象IDを保存する

---

## 4.2 アプリケーションログ

- アプリケーションログは障害調査目的で出力する
- ログレベルは以下を想定する
  - INFO：業務処理の開始・終了
  - WARN：想定外だが処理継続可能な事象
  - ERROR：例外発生時
- 個人情報・認証情報はログに出力しない
- 本番環境ではスタックトレースを画面表示しない

---

# 5. 性能要件

- 通常利用時、主要画面の応答時間は **3秒以内** を目標とする
- 同時アクセス数は少数（部活動単位）を想定する
- 高負荷処理や大量データ処理はフェーズ1対象外とする
- 一覧取得時はページングを実装する

---

# 6. 排他制御・整合性

- 同一申請に対する同時承認を防止する
- 状態遷移はトランザクション内で一貫して処理する
- 不正な状態遷移はバックエンドで拒否する
- 監査ログ記録と状態変更は同一トランザクションで処理する

---

# 7. エラー・例外処理

- 入力不備や業務ルール違反は明確なエラーとして返却する
- エラーメッセージは利用者が理解可能な内容とする
- システムエラー発生時は詳細情報を外部に露出しない
- HTTPステータスコードを適切に使用する（400系／500系）

---

# 8. 運用・保守要件

- 環境ごとに設定値を切り替え可能とする（dev / prod）
- DBスキーマ変更はマイグレーションツール（例：Flyway）で管理する
- 管理者は監査ログを参照可能とする
- ソースコードはGitでバージョン管理する
- CI/CDによりビルド・テストを自動化する
